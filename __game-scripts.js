var PickerRaycast=pc.createScript("pickerRaycast");PickerRaycast.attributes.add("pickedup",{type:"entity"}),PickerRaycast.attributes.add("holding",{type:"boolean"}),PickerRaycast.prototype.initialize=function(){console.log("initializing"),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onSelect,this),this.pov=this.entity.camera},PickerRaycast.prototype.updateAttr=function(t,i){this.pickedup=t,this.holding=i},PickerRaycast.prototype.onSelect=function(t){var i=this;if(t.button===pc.MOUSEBUTTON_LEFT){console.log(this.pov);var o=this.pov.screenToWorld(t.x,t.y,this.pov.nearClip),c=this.pov.screenToWorld(t.x,t.y,this.pov.farClip);this.app.systems.rigidbody.raycastFirst(o,c,(function(t){var o=t.entity;try{null!==o&&(o.script.pickable&&!1===i.holding?(o.script.pickable.pickup(),i.updateAttr(o,!0),console.log(i.pickedup),console.log(i.holding)):o.script.button&&o.script.button.activate())}catch(t){console.log("not-pickable")}}))}t.button===pc.MOUSEBUTTON_RIGHT&&!0===this.holding&&(console.log(this.pickedup),console.log(this.holding),this.pickedup.script.pickable.drop(),this.holding=!1)};var Pickable=pc.createScript("pickable");Pickable.attributes.add("force",{type:"number",default:3}),Pickable.prototype.initialize=function(){this.picked=!1,this.player=this.app.root.findByName("Player"),this.camera=this.app.root.findByName("Camera")},Pickable.prototype.pickup=function(){this.picked=!0,this.entity.collision.enabled=!1},Pickable.prototype.drop=function(){this.picked=!1,this.entity.collision.enabled=!0,direction=this.camera.forward.normalize(),this.entity.rigidbody.applyImpulse(direction.scale(this.force)),console.log(direction)},Pickable.prototype.postUpdate=function(i){if(this.picked){var t=this.camera.position;t.y+=2,this.entity.setLocalPosition(t)}};var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;var e=this.app;e.mouse.on("mousemove",this._onMouseMove,this),e.mouse.on("mousedown",(function(){e.mouse.enablePointerLock()}),this),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,s=this.app,o=this.camera.forward,i=this.camera.right,r=0,n=0;(s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_Q))&&(r-=i.x,n-=i.z),s.keyboard.isPressed(pc.KEY_D)&&(r+=i.x,n+=i.z),s.keyboard.isPressed(pc.KEY_W)&&(r+=o.x,n+=o.z),s.keyboard.isPressed(pc.KEY_S)&&(r-=o.x,n-=o.z),0!==r&&0!==n&&(t.set(r,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.y>=-74.5&&this.eulers.y<=88?(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy):this.eulers.y<=74.5?this.eulers.y=-74:this.eulers.y=87)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var PressurePlate=pc.createScript("pressurePlate");PressurePlate.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this),this.entity.collision.on("triggerleave",this.onTriggerLeave,this)},PressurePlate.prototype.onTriggerEnter=function(e){console.log(e.name+" has entered"),this.entity.translateLocal(0,-.02,0),this.fire("move"),this.fire("openShuttle")},PressurePlate.prototype.onTriggerLeave=function(e){console.log(e.name+" has exited"),this.entity.translateLocal(0,.02,0),this.fire("back")};var MoveListener=pc.createScript("moveListener");MoveListener.attributes.add("PressurePlate",{type:"entity",default:null}),MoveListener.attributes.add("Button1",{type:"entity",default:null}),MoveListener.attributes.add("Button2",{type:"entity",default:null}),MoveListener.attributes.add("origin",{type:"vec3"}),MoveListener.attributes.add("dest",{type:"vec3"}),MoveListener.attributes.add("time",{type:"number"}),MoveListener.prototype.initialize=function(){this.entity.setPosition(this.origin);try{this.PressurePlate.script.pressurePlate.on("move",this.move,this),this.PressurePlate.script.pressurePlate.on("back",this.back,this)}catch(t){console.log("no plate linked")}try{this.Button1.script.button.on("move",this.move,this),this.Button1.script.button.on("back",this.back,this)}catch(t){console.log("no button1 linked")}try{this.Button2.script.button.on("move",this.move,this),this.Button2.script.button.on("back",this.back,this)}catch(t){console.log("no button1 linked")}this.direction=new pc.Vec3,this.direction.sub2(this.origin,this.dest)},MoveListener.prototype.move=function(){this.tween1=this.entity.tween(this.entity.getLocalPosition()).to(this.dest,this.time,pc.SineOut),console.log("i heard that"),this.tween1.start()},MoveListener.prototype.back=function(){this.tween2=this.entity.tween(this.entity.getLocalPosition()).to(this.origin,this.time,pc.SineOut),console.log("i heard that too"),this.tween2.start()};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this},from:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,n;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,n))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,n))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,n,s=0===this.duration?1:this.time/this.duration,r=this.easing(s);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],n=this._ev[h],this.target[h]=e+(n-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceIn=function(t){return 1-BounceOut(1-t)},BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=n*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.Application.getApplication();t&&t.addTweenManager()}();var Button=pc.createScript("button");Button.attributes.add("Plate",{type:"entity",default:null}),Button.attributes.add("cycle",{type:"boolean",default:!0,title:"cycle?"}),Button.prototype.initialize=function(){this.activated=!1},Button.prototype.activate=function(){!1===this.activated?(this.fire("move"),this.Plate.translateLocal(0,0,.2)):(this.fire("back"),this.Plate.translateLocal(0,0,-.2)),this.cycle&&(this.activated=!this.activated)};var Water=pc.createScript("water");Water.prototype.initialize=function(){this.speed=-.05,this._offset=new pc.Vec2(1,1),this.quad=this.entity.model.meshInstances[0],this.mat=this.quad.material,this.override=this.mat.getUniform("normalMapOffset",this._offset),this.quad.setParameter(this.override),this.mat.chunks.normalMapFloatPS=this.app.assets.find("WaterNormal").resource,this.mat.reflectivity=this.app.scene.skyboxIntensity,this.mat.update(),this.constLayer2=this.app.graphicsDevice.scope.resolve("layer2_offset"),this.layer2=new pc.Vec2(1,1),this.constLayer2.setValue(this.layer2.data),this.constLayer1=this.app.graphicsDevice.scope.resolve("layer1_offset"),this.layer1=new pc.Vec2(1,1),this.constLayer1.setValue(this.layer1.data)},Water.prototype.update=function(e){this.override.value[3]+=e*this.speed,this.override.value[2]+=e*this.speed*-.25,this.layer1.x+=e*this.speed,this.layer1.y+=e*this.speed*-.25,this.constLayer1.setValue(this.layer1.data),this.layer2.x+=e*this.speed*2,this.layer2.y+=e*this.speed*-.25*2,this.constLayer2.setValue(this.layer2.data)};var SceneChanger=pc.createScript("sceneChanger");SceneChanger.attributes.add("sceneName",{type:"string",default:"",title:"Next Scene"}),SceneChanger.attributes.add("VictoryEmitter",{type:"entity"}),SceneChanger.prototype.initialize=function(){this.VictoryEmitter.script.victoryEmitter.on("victory",this.changeScene,this)},SceneChanger.prototype.changeScene=function(e){var t=this.app.root.findByName("Root"),n=this.app.scenes.find(this.sceneName);this.app.scenes.loadSceneHierarchy(n.url,(function(e,n){e?console.error(e):t.destroy()}))};var VictoryEmitter=pc.createScript("victoryEmitter");VictoryEmitter.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},VictoryEmitter.prototype.onTriggerEnter=function(t){"Player"==t.name&&(console.log("player entered"),this.fire("victory"))};var ShuttleDoor=pc.createScript("shuttleDoor");ShuttleDoor.attributes.add("PressurePlate",{type:"entity",default:null}),ShuttleDoor.attributes.add("dest",{type:"vec3"}),ShuttleDoor.attributes.add("time",{type:"number"}),ShuttleDoor.prototype.initialize=function(){this.PressurePlate.script.pressurePlate.on("openShuttle",this.open,this)},ShuttleDoor.prototype.open=function(){console.log(this.entity.getLocalPosition());this.tween1=this.entity.tween(this.entity.getLocalPosition()).to(this.dest,this.time,pc.SineOut).yoyo(!0).repeat(2).on("complete",(function(){console.log(this.entity.getLocalPosition())})),this.tween1.start(),console.log("Tweened")};var TimedLight=pc.createScript("timedLight");TimedLight.attributes.add("delay",{type:"number"}),TimedLight.attributes.add("trigger",{type:"entity",default:null}),TimedLight.prototype.initialize=function(){this.entity.enabled=!1,this.trigger.collision.on("triggerenter",this.onTriggerEnter,this)},TimedLight.prototype.onTriggerEnter=function(t){"Player"==t.name&&(this.entity.enabled=!0,console.log("Lights Enabled"))};var WheelPuzzle=pc.createScript("wheelPuzzle");WheelPuzzle.attributes.add("time",{type:"number"}),WheelPuzzle.attributes.add("dest",{type:"vec3"}),WheelPuzzle.prototype.initialize=function(){this.tween=this.entity.tween(this.entity.getLocalEulerAngles()).rotate(this.dest,this.time,pc.Linear).loop(!0),this.tween.start(),console.log("Tweened")};var MovingPlatform=pc.createScript("movingPlatform");MovingPlatform.attributes.add("PressurePlate",{type:"entity",default:null}),MovingPlatform.attributes.add("origin",{type:"vec3"}),MovingPlatform.attributes.add("dest",{type:"vec3"}),MovingPlatform.attributes.add("time",{type:"number"}),MovingPlatform.prototype.initialize=function(){this.started=!1,this.paused=!1;try{this.PressurePlate.script.pressurePlate.on("move",this.move,this),this.PressurePlate.script.pressurePlate.on("back",this.back,this)}catch(t){console.log("no plate linked")}console.log(this.started)},MovingPlatform.prototype.move=function(){!1===this.started?(this.tween1=this.entity.tween(this.entity.getLocalPosition()).to(this.dest,this.time,pc.Linear).yoyo(!0).loop(!0).start(),this.started=!0,console.log(this.started)):!0===this.paused&&!0===this.started&&(this.tween1.resume(),this.paused=!1)},MovingPlatform.prototype.back=function(){this.tween1.pause(),this.paused=!0,console.log(this.started)};